<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>POC Scanner EAN</title>

<style>
body {
  margin:0;
  background:black;
  color:white;
  font-family:system-ui, -apple-system, sans-serif;
}

video {
  width:100vw;
  height:100vh;
  object-fit:cover;
}

.overlay {
  position:fixed;
  top:50%;
  left:50%;
  width:70vw;
  height:40vw;
  max-height:40vh;
  border:2px solid #00ff99;
  transform:translate(-50%,-50%);
  pointer-events:none;
}

.result {
  position:fixed;
  bottom:0;
  width:100%;
  padding:12px;
  background:rgba(0,0,0,0.7);
  text-align:center;
  font-size:16px;
}

.start {
  position:fixed;
  inset:0;
  background:black;
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:10;
}

button {
  font-size:18px;
  padding:16px 24px;
  border-radius:12px;
  border:none;
  background:#00ff99;
  color:black;
}

#log {
  position:fixed;
  top:0;
  left:0;
  width:100%;
  max-height:30vh;
  overflow:auto;
  background:#111;
  color:#0f0;
  font-size:12px;
  padding:4px;
  z-index:9999;
}
</style>
</head>

<body>

<div id="log"></div>

<div class="start" id="startScreen">
  <button id="startBtn">ðŸ“· DÃ©marrer le scan EAN</button>
</div>

<div class="overlay"></div>
<div class="result" id="result">Aligne le code EAN dans le cadre</div>

<script src="https://unpkg.com/quagga@0.12.1/dist/quagga.min.js"></script>
<script>
const logDiv = document.getElementById("log");
const resultBox = document.getElementById("result");
const startScreen = document.getElementById("startScreen");

function log(msg){
  console.log(msg);
  logDiv.innerHTML += msg + "<br>";
  logDiv.scrollTop = logDiv.scrollHeight;
}

function startQuagga() {
  log("DÃ©marrage Quaggaâ€¦");

  Quagga.init({
    inputStream : {
      type : "LiveStream",
      target: document.querySelector('body'), // on met la vidÃ©o full page
      constraints: {
        facingMode: "environment" // camÃ©ra arriÃ¨re
      }
    },
    decoder : {
      readers : ["ean_reader"] // EAN uniquement
    },
    locate: true // active la localisation du code
  }, function(err) {
      if (err) {
          log("Erreur Quagga : " + err);
          return;
      }
      log("Quagga initialisÃ© âœ…");
      Quagga.start();
  });

  // callback dÃ©tection
  Quagga.onDetected(function(result) {
    const code = result.codeResult.code;
    log("Code dÃ©tectÃ© : " + code);
    resultBox.textContent = "âœ… " + code;
    // arrÃªter aprÃ¨s dÃ©tection
    Quagga.stop();
  });
}

document.getElementById("startBtn").addEventListener("click", () => {
  startScreen.style.display = "none";
  startQuagga();
});
</script>

</body>
</html>
